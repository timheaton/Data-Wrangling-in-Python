database = '[DataBase Name]' #the database to be consumed
output_directory = ("Your folder/") #where you want the files placed


# Do not change anything below this line
import pymssql
import pandas as pd
import numpy
from pydqc import infer_schema, data_summary, data_compare, data_consist
import os
file_type = (".csv")

## instance a python db connection object- same form as psycopg2/python-mysql drivers also
conn = pymssql.connect(server="warehouse", user="theaton",password="G0Dawg52019!!", port="1433")  # You can lookup the port number inside SQL server. 

stmt = "SELECT * FROM" + database + ".INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE'"

# Excute Query here
tables = pd.read_sql(stmt,conn)

for i in tables["TABLE_NAME"]:
    stmt = "SELECT * FROM" + database + ".[dbo].["+i+"]"

# Excute Query here
    table_data = pd.read_sql(stmt,conn)
    sample_data = table_data.head(1000)
    try:
        infer_schema.infer_schema(sample_data, fname = database +'_' + i ,output_root=output_directory, 
                  sample_size=1.0, type_threshold=0.5, n_jobs=2, base_schema=None)
    except KeyError:
        print(i + "_KeyError")
        pass
    except TypeError:
        print(i + "_TypeError")
        pass
    except UnicodeDecodeError:
        print(i + "_UnicodeDecodeError")
        pass

#NOTE the list of "_KeyErrors" are usually those tables with no data
